#!/usr/bin/make -f
# -*- mode: makefile; coding: utf-8 -*-

include /usr/share/cdbs/1/rules/debhelper.mk
DEB_PYTHON_SYSTEM = pysupport
DEB_PYTHON_MODULE_PACKAGE = python-psychopy
DEB_PYTHON_MODULE_PACKAGES = python-psychopy
include /usr/share/cdbs/1/class/python-distutils.mk

debian/psychopy.1: debian/psychopy
	PYTHONPATH=. help2man -N -n "Creating psychology stimuli in Python" $^ > $@
## cleanup
	rm -f psychopy/__init__.pyc

install/python-psychopy:: debian/psychopy.1
## Fix up permissions on images -- pushed upstream, but left here
## just to make sure everything is ok
	find $(DEB_DESTDIR) -name \*.png -o -name \*.ico -o -name \*.jpg | \
		xargs chmod a-x
## # Correct interpreter lines
## was pushed upstream, but snippet is left in for possible uses
## 	find $(DEB_DESTDIR) -name \*.py \
##     | xargs sed -i -e '1 s,^#!.*python.*,#!/usr/bin/env python,g'

## Install runner
	cp -p debian/psychopy $(DEB_DESTDIR)/usr/bin/

# Make tree dfsg-compliant
# Need to be run whenever master branch gets merged in
dfsg:
	@echo "I: Cleaning up the source tree to make it DFSG-compliant"
	-rm -f PsychoPyBuilder/*bak \
	  psychopy/demos/*.ttf psychopy/demos/*.mpg \
	  psychopy/ext/*bits*.* \
	  buildExeInstaller.nsi buildWinDistributions.bat \
	  googlecode_upload.py
	-rm -rf psychopy/serial windlls

# immediately useable documentation
#DEB_COMPRESS_EXCLUDE := .py .pdf .html .css .jpg .txt
DEB_INSTALL_CHANGELOGS_ALL := CHANGELOG.txt
DEB_INSTALL_DOCS_python-psychopy := README.txt debian/README.Debian-source
DEB_INSTALL_MANPAGES_python-psychopy := debian/psychopy.1

clean::
	rm -f debian/psychopy.1

# do not actually install demos -- just symlink to them
#DEB_INSTALL_EXAMPLES_python-psychopy := psychopy/demos/*

